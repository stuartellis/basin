variables:
  AWS_REGION: eu-west-2
  AWS_ECR_ROLE: arn:aws:iam::333594256635:role/SjeEcrPublish
  DOCKER_HOST: tcp://docker:2375
  TARGET_CPU_ARCH: x86_64

publish:
  image: 
    name: amazonlinux:2.0.20220912.1
    entrypoint: [""]
  services:
    - docker:20.10.17-dind
  before_script:
    - yum update -q -y
    - yum install -q -y awscli-2-2.7.8-1.amzn2022.0.3 docker-20.10.17-1.amzn2022.0.1 jq-1.6-10.amzn2022.x86_64 make-4.3-5.amzn2022
  script:
    - make --version
    - make info
    # - aws sts get-caller-identity # FIXME: Remove when no longer needed
    # - source ./scripts/assume-iam-role.sh $AWS_ECR_ROLE basin
    # - aws sts get-caller-identity # FIXME: Remove when no longer needed
    # - make basin-build TARGET_CPU_ARCH=$TARGET_CPU_ARCH
    # - make basin-push
